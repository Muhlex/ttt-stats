(()=>{var P=Object.defineProperty,B=Object.defineProperties;var x=Object.getOwnPropertyDescriptors;var N=Object.getOwnPropertySymbols;var K=Object.prototype.hasOwnProperty,q=Object.prototype.propertyIsEnumerable;var E=(d,u,c)=>u in d?P(d,u,{enumerable:!0,configurable:!0,writable:!0,value:c}):d[u]=c,h=(d,u)=>{for(var c in u||(u={}))K.call(u,c)&&E(d,c,u[c]);if(N)for(var c of N(u))q.call(u,c)&&E(d,c,u[c]);return d},R=(d,u)=>B(d,x(u));(function(){"use strict";function d(e,t){const n=[];for(let s=0;s<e.length;s+=t)n.push(e.slice(s,s+t));return n}async function u(e){return await(await fetch(e)).text()}function c(e){let t=e.replaceAll(`\r
`,`
`);return t=t.replace(/.* -{20,}\n.*InitGame\n.*TTT_ROUND_START.*\n.*TTT_ROUND_END.*(?:.|\n)*?.*ShutdownGame.*\n.*-{20,}\n/g,""),t}function v(e){return e.replace(/\^[\d:;]/g,"")}function M(e){const t=new Map,n=[...e.matchAll(/\n *\d*:\d* J;(.*?);.*?;(.*)/g)];for(const[,s,a]of n)t.set(s,{guid:s,name:v(a).trim(),isBot:s.length!==16});return t}function g(e){const[t,n]=e.split(":");return Number(t)*60+Number(n)}function O(e){return e.match(/\d*:\d* InitGame(?:.|\n)*?ShutdownGame/g)}function b(e,t){return e.map(n=>{const s=S(n,t);return{date:G(n),players:s,outcome:U(n),events:A(n,s,t)}})}function k(e){return e.filter(({players:t,outcome:n})=>t.length&&n).filter(({players:t})=>t.every(({isBot:n})=>!n))}function G(e){const t=e.match(/\n *\d*:\d* TTT_ROUND_START;(\d+)/);return t?new Date(Number(t[1])*1e3):null}function S(e,t){const n=e.match(/\n *\d*:\d* TTT_PLAYERS;(.*)\n/);return n?n[1].split(";").map(s=>{const[,a,o]=s.match(/(.*)<(.*)>/);return R(h({},t.get(a)),{role:o})}):[]}function U(e){const t=e.match(/\n *\d*:\d* TTT_ROUND_END;(.*?);(.*?);(.*);*/);if(!t)return null;const[,n,s,a]=t;return{winner:n,reason:s,roundLength:Number(a)}}function A(e,t,n){const s=e.match(/\n *(\d*:\d*) TTT_ROUND_START.*\n((?:.|\n)*?)\n *(\d*:\d*) TTT_ROUND_END/);if(!s)return null;const[,a,o,i]=s,m=g(a),f=g(i),l=o.split(`
`).map(r=>L(r,t)||I(r,t)||C(r,t,n)||null).filter(r=>r).flat(1);return[{type:"round-start",time:m},...l,{type:"round-end",time:f}].map(r=>R(h({},r),{time:r.time-m}))}function L(e,t){const n=e.match(/ *(\d*:\d*) (D|K);(.*);.*;.*;.*;(.*);.*;.*;.*;(.*);(.*);(.*);(.*)/);if(!n)return null;const[,s,a,o,i,m,f,l,r]=n,_=g(s),w=t.find(({guid:p})=>p===o),y=t.find(({guid:p})=>p===i);let T=m;l==="MOD_MELEE"&&!["combat_knife_mp","riotshield_mp"].includes(T)&&(T="melee_mp");const D=[{type:"damage",time:_,victim:w,attacker:y,damage:Number(f),weapon:T,means:l,hitLoc:r}];return a==="K"&&D.push({type:"death",time:_,victim:w,attacker:y,damage:Number(f),weapon:T,means:l,hitLoc:r}),D}function I(e,t){const n=e.match(/ *(\d*:\d*) TTT_ITEM_BOUGHT;(.*);.*;.*;(.*)/);if(!n)return null;const[,s,a,o]=n,i=t.find(m=>m.guid===a);return{type:"item-buy",time:g(s),player:i,item:o}}function C(e,t,n){const s=e.match(/ *(\d*:\d*) say;(.*?);.*?;.*?;(.*)/);if(!s)return null;const[,a,o,i]=s,m=t.find(r=>r.guid===o)||n.get(o)||{guid:o},f=i[0]===""?"quickmessage":"chat",l=["",""].includes(i[0])?i.slice(1):i;return{type:"say",time:g(a),player:m,message:l,messageType:f}}self.onmessage=async({data:{url:e}})=>{self.postMessage({status:"fetch"});const t=await u(e);self.postMessage({status:"parse",progress:0});const n=c(t),s=M(n),o=d(O(n),32).reduce((m,f,l,{length:r})=>(self.postMessage({status:"parse",progress:(l+1)/(r||1)}),m.concat(b(f,s))),[]),i=k(o);self.postMessage({status:"done",data:{rounds:i,playerMap:s}})}})();})();
