(()=>{var P=Object.defineProperty,x=Object.defineProperties;var B=Object.getOwnPropertyDescriptors;var N=Object.getOwnPropertySymbols;var F=Object.prototype.hasOwnProperty,K=Object.prototype.propertyIsEnumerable;var E=(d,o,u)=>o in d?P(d,o,{enumerable:!0,configurable:!0,writable:!0,value:u}):d[o]=u,R=(d,o)=>{for(var u in o||(o={}))F.call(o,u)&&E(d,u,o[u]);if(N)for(var u of N(o))K.call(o,u)&&E(d,u,o[u]);return d},_=(d,o)=>x(d,B(o));(function(){"use strict";function d(e,t){const n=parseInt(t);if(n===0)throw new Error("Cannot chunk into chunks of 0 length.");const s=[];for(let r=0;r<e.length;r+=n)s.push(e.slice(r,r+n));return s}async function o(e){return await(await fetch(e)).text()}function u(e){let t=e.replaceAll(`\r
`,`
`);return t=t.replace(/.* -{20,}\n.*InitGame\n.*TTT_ROUND_START.*\n.*TTT_ROUND_END.*(?:.|\n)*?.*ShutdownGame.*\n.*-{20,}\n/g,""),t}function M(e){return e.replace(/\^[\d:;]/g,"")}function v(e){const t=new Map,n=[...e.matchAll(/\n *\d*:\d* J;(.*?);.*?;(.*)/g)];for(const[,s,r]of n)t.set(s,{guid:s,name:M(r).trim(),isBot:s.length!==16});return t}function f(e){const[t,n]=e.split(":");return Number(t)*60+Number(n)}function k(e){return e.match(/\d*:\d* InitGame(?:.|\n)*?ShutdownGame/g)}function O(e,t){return e.map(n=>{const s=G(n,t);return{date:L(n),players:s,outcome:I(n),events:S(n,s,t)}})}function b(e){return e.filter(({players:t,outcome:n})=>t.length&&n).filter(({players:t})=>t.every(({isBot:n})=>!n))}function L(e){const t=e.match(/\n *\d*:\d* TTT_ROUND_START;(\d+)/);return t?new Date(Number(t[1])*1e3):null}function G(e,t){const n=e.match(/\n *\d*:\d* TTT_PLAYERS;(.*)\n/);return n?n[1].split(";").map(s=>{const[,r,c]=s.match(/(.*)<(.*)>/);return _(R({},t.get(r)),{role:c})}):[]}function I(e){const t=e.match(/\n *\d*:\d* TTT_ROUND_END;(.*?);(.*?);(.*);*/);if(!t)return null;const[,n,s,r]=t;return{winner:n,reason:s,roundLength:Number(r)}}function S(e,t,n){const s=e.match(/\n *(\d*:\d*) TTT_ROUND_START.*\n((?:.|\n)*?)\n *(\d*:\d*) TTT_ROUND_END/);if(!s)return null;const[,r,c,i]=s,l=f(r),g=f(i),m=c.split(`
`).map(a=>U(a,t)||A(a,t)||C(a,t,n)||null).filter(a=>a).flat(1);return[{type:"round-start",time:l},...m,{type:"round-end",time:g}].map(a=>_(R({},a),{time:a.time-l}))}function U(e,t){const n=e.match(/ *(\d*:\d*) (D|K);(.*);.*;.*;.*;(.*);.*;.*;.*;(.*);(.*);(.*);(.*)/);if(!n)return null;const[,s,r,c,i,l,g,m,a]=n,p=f(s),T=t.find(({guid:w})=>w===c),y=t.find(({guid:w})=>w===i);let h=l;m==="MOD_MELEE"&&!["combat_knife_mp","riotshield_mp"].includes(h)&&(h="melee_mp");const D=[{type:"damage",time:p,victim:T,attacker:y,damage:Number(g),weapon:h,means:m,hitLoc:a}];return r==="K"&&D.push({type:"death",time:p,victim:T,attacker:y,damage:Number(g),weapon:h,means:m,hitLoc:a}),D}function A(e,t){const n=e.match(/ *(\d*:\d*) TTT_ITEM_BOUGHT;(.*);.*;.*;(.*)/);if(!n)return null;const[,s,r,c]=n,i=t.find(l=>l.guid===r);return{type:"item-buy",time:f(s),player:i,item:c}}function C(e,t,n){const s=e.match(/ *(\d*:\d*) say;(.*?);.*?;.*?;(.*)/);if(!s)return null;const[,r,c,i]=s,l=t.find(a=>a.guid===c)||n.get(c)||{guid:c},g=i[0]===""?"quickmessage":"chat",m=["",""].includes(i[0])?i.slice(1):i;return{type:"say",time:f(r),player:l,message:m,messageType:g}}self.onmessage=async({data:{url:e}})=>{self.postMessage({status:"fetch",message:"Downloading Logfile"});const t=await o(e);self.postMessage({status:"parse",message:"Parsing Data",progress:"Preparing"});const n=u(t),s=v(n),r=k(n),i=d(r,Math.max(r.length/100,8)).reduce((g,m,a,{length:p})=>{const T=(a+1)/(p||1);return self.postMessage({status:"parse",progress:(T*100).toFixed()+"%"}),g.concat(O(m,s))},[]);self.postMessage({status:"parse",progress:"Cleaning up"});const l=b(i);self.postMessage({status:"done",data:{rounds:l,playerMap:s}})},self.addEventListener("unhandledrejection",e=>{throw e.preventDefault(),e.reason})})();})();
