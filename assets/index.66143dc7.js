var t=Object.defineProperty,e=Object.defineProperties,n=Object.getOwnPropertyDescriptors,r=Object.getOwnPropertySymbols,a=Object.prototype.hasOwnProperty,s=Object.prototype.propertyIsEnumerable,l=(e,n,r)=>n in e?t(e,n,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[n]=r,o=(t,e)=>{for(var n in e||(e={}))a.call(e,n)&&l(t,n,e[n]);if(r)for(var n of r(e))s.call(e,n)&&l(t,n,e[n]);return t};import{S as i,i as c,s as u,e as d,a as m,b as $,n as p,d as f,L as g,c as v,m as y,t as b,f as h,g as x,h as w,u as T,j as q,k as C,l as D,o as P,p as O,q as _,r as N,v as S,w as A,x as I,y as M,C as R,z as j,A as k,B as E,D as G,E as U,F as B,G as F,R as L,H as W,I as J,J as z}from"./vendor.f24a3d25.js";function H(t){const e=t.match(/TTT_ROUND_START;\d*;\d*;\d*;(\d+)/);return e?new Date(1e3*Number(e[1])):null}function K(t){let e=t.match(/TTT_ROUND_START;(\d*);(\d*);(\d*)/);return e?(e=e.slice(1).map((t=>Number(t))),e[0]<1?null:{total:e[0],innocent:e[0]-e[1]-e[2],traitor:e[1],detective:e[2]}):null}function Q(t,e){return[...t.matchAll(/J;(.*?);/g)].map((([,t])=>({guid:t,meta:e.get(t)})))}function V(t){return[...t.matchAll(/TTT_ITEM_BOUGHT;(.*?);(.*?);(.*?);(.*)/g)].map((t=>({name:t[4],role:t[3],player:t[1]})))}function X(t){const e=t.match(/TTT_ROUND_END;(.*?);(.*?);(.*);*/);return e?{winner:e[1],reason:e[2],roundLength:Number(e[3])}:null}async function Y(){try{const t=await fetch("https://muhlex.github.io/ttt-stats-log/full.log");let e=(await t.text()).replaceAll("\r","");e=e.replace(/.* -{20,}\n.*InitGame\n.*TTT_ROUND_START.*\n.*TTT_ROUND_END.*(?:.|\n)*?.*ShutdownGame.*\n.*-{20,}\n/g,"");const n=function(t){const e=new Map,n=[...t.matchAll(/J;(.*?);.*?;(.*)/g)];for(const[,a,s]of n)e.set(a,{name:(r=s,r.replace(/\^[\d:;]/g,"")).trim(),isBot:16!==a.length});var r;return e}(e),r=e.match(/\d*:\d* InitGame(?:.|\n)*?ShutdownGame/g).map((t=>({date:H(t),playerCounts:K(t),players:Q(t,n),items:V(t),outcome:X(t)}))).filter((({playerCounts:t,outcome:e})=>t&&e)).filter((({players:t})=>t.every((({meta:{isBot:t}})=>!t))));return{players:n,rounds:r}}catch(t){return t}}function Z(t){const r=t.reduce(((t,e)=>{const n={playtime:t.playtime+e.outcome.roundLength,wins:t.wins};n.wins[e.outcome.winner]||(n.wins[e.outcome.winner]={});const r=n.wins[e.outcome.winner];return r[e.outcome.reason]=(r[e.outcome.reason]||0)+1,n}),{playtime:0,wins:{}});return a=o({rounds:t.length||0},r),s={playtime:Math.floor(r.playtime)},e(a,n(s));var a,s}function tt(t){let e;return{c(){e=d("div"),e.textContent="Loading Data...",m(e,"class","svelte-15li9q4")},m(t,n){$(t,e,n)},p:p,i:p,o:p,d(t){t&&f(e)}}}class et extends i{constructor(t){super(),c(this,t,null,tt,u,{})}}function nt(t){let e;const n=t[1].default,r=w(n,t,t[2],null);return{c(){r&&r.c()},m(t,n){r&&r.m(t,n),e=!0},p(t,a){r&&r.p&&(!e||4&a)&&T(r,n,t,t[2],e?C(n,t[2],a,null):q(t[2]),null)},i(t){e||(b(r,t),e=!0)},o(t){h(r,t),e=!1},d(t){r&&r.d(t)}}}function rt(t){let e,n;return e=new g({props:{to:t[0],getProps:at,$$slots:{default:[nt]},$$scope:{ctx:t}}}),{c(){v(e.$$.fragment)},m(t,r){y(e,t,r),n=!0},p(t,[n]){const r={};1&n&&(r.to=t[0]),4&n&&(r.$$scope={dirty:n,ctx:t}),e.$set(r)},i(t){n||(b(e.$$.fragment,t),n=!0)},o(t){h(e.$$.fragment,t),n=!1},d(t){x(e,t)}}}function at({href:t,isPartiallyCurrent:e,isCurrent:n}){return("/ttt-stats/"===t?n:e||n)?{class:"active"}:{}}function st(t,e,n){let{$$slots:r={},$$scope:a}=e,{to:s}=e;return t.$$set=t=>{"to"in t&&n(0,s=t.to),"$$scope"in t&&n(2,a=t.$$scope)},[s,r,a]}class lt extends i{constructor(t){super(),c(this,t,st,rt,u,{to:0})}}function ot(t){let e;return{c(){e=O("Overview")},m(t,n){$(t,e,n)},d(t){t&&f(e)}}}function it(t){let e;return{c(){e=O("Player Stats")},m(t,n){$(t,e,n)},d(t){t&&f(e)}}}function ct(t){let e,n,r,a,s;return n=new lt({props:{to:"/",$$slots:{default:[ot]},$$scope:{ctx:t}}}),a=new lt({props:{to:"/players",$$slots:{default:[it]},$$scope:{ctx:t}}}),{c(){e=d("nav"),v(n.$$.fragment),r=D(),v(a.$$.fragment),m(e,"class","svelte-1ht3z4d")},m(t,l){$(t,e,l),y(n,e,null),P(e,r),y(a,e,null),s=!0},p(t,[e]){const r={};1&e&&(r.$$scope={dirty:e,ctx:t}),n.$set(r);const s={};1&e&&(s.$$scope={dirty:e,ctx:t}),a.$set(s)},i(t){s||(b(n.$$.fragment,t),b(a.$$.fragment,t),s=!0)},o(t){h(n.$$.fragment,t),h(a.$$.fragment,t),s=!1},d(t){t&&f(e),x(n),x(a)}}}class ut extends i{constructor(t){super(),c(this,t,null,ct,u,{})}}function dt(t){let e,n,r,a,s,l,o,i,c,u,g,v,y,b,h,x,w,T,q,C,O,A,I,M,R,j,k,E,G;return{c(){e=d("div"),n=d("h2"),n.textContent="Filters",r=D(),a=d("div"),s=d("div"),l=d("h3"),l.textContent="Playercount",o=D(),i=d("label"),i.textContent="min",c=D(),u=d("input"),v=D(),y=d("label"),y.textContent="max",b=D(),h=d("input"),w=D(),T=d("div"),q=d("h3"),q.textContent="Date",C=D(),O=d("label"),O.textContent="between",A=D(),I=d("input"),M=D(),R=d("label"),R.textContent="and",j=D(),k=d("input"),m(n,"class","svelte-1bqqd9"),m(l,"class","svelte-1bqqd9"),m(i,"for","filter-min-players"),m(i,"class","svelte-1bqqd9"),m(u,"id","filter-min-players"),m(u,"type","number"),m(u,"min","1"),m(u,"max","18"),u.value=g=t[0].minPlayers,_(u,"width","calc(2ch + 32px)"),m(u,"class","svelte-1bqqd9"),m(y,"for","filter-max-players"),m(y,"class","svelte-1bqqd9"),m(h,"id","filter-max-players"),m(h,"type","number"),m(h,"min","1"),m(h,"max","18"),h.value=x=t[0].maxPlayers,_(h,"width","calc(2ch + 32px)"),m(h,"class","svelte-1bqqd9"),m(s,"class","filter svelte-1bqqd9"),m(q,"class","svelte-1bqqd9"),m(O,"for","filter-min-players"),m(O,"class","svelte-1bqqd9"),m(I,"id","filter-min-date"),m(I,"type","date"),m(I,"max",t[2]),I.value=t[1],m(I,"class","svelte-1bqqd9"),m(R,"for","filter-max-players"),m(R,"class","svelte-1bqqd9"),m(k,"id","filter-max-date"),m(k,"type","date"),m(k,"max",t[2]),k.value=t[2],m(k,"class","svelte-1bqqd9"),m(T,"class","filter svelte-1bqqd9"),m(a,"class","filter-groups svelte-1bqqd9"),m(e,"class","filters svelte-1bqqd9")},m(d,m){$(d,e,m),P(e,n),P(e,r),P(e,a),P(a,s),P(s,l),P(s,o),P(s,i),P(s,c),P(s,u),P(s,v),P(s,y),P(s,b),P(s,h),P(a,w),P(a,T),P(T,q),P(T,C),P(T,O),P(T,A),P(T,I),P(T,M),P(T,R),P(T,j),P(T,k),E||(G=[N(u,"input",t[3]),N(h,"input",t[4]),N(I,"input",t[5]),N(k,"input",t[6])],E=!0)},p(t,[e]){1&e&&g!==(g=t[0].minPlayers)&&(u.value=g),1&e&&x!==(x=t[0].maxPlayers)&&(h.value=x)},i:p,o:p,d(t){t&&f(e),E=!1,S(G)}}}function mt(t,e,n){const r=new Date,a=new Date;a.setMonth(a.getMonth()-2);const s=a.toISOString().split("T")[0],l=r.toISOString().split("T")[0];let{filters:o={minPlayers:6,maxPlayers:18,minDate:new Date(s),maxDate:new Date(l)}}=e;return t.$$set=t=>{"filters"in t&&n(0,o=t.filters)},[o,s,l,({target:{value:t}})=>{n(0,o.minPlayers=Number(t),o),n(0,o.maxPlayers=Math.max(Number(t),o.maxPlayers),o)},({target:{value:t}})=>{n(0,o.maxPlayers=Number(t),o),n(0,o.minPlayers=Math.min(Number(t),o.minPlayers),o)},({target:{value:t}})=>{n(0,o.minDate=new Date(t),o)},({target:{value:t}})=>{n(0,o.maxDate=new Date(t),o)}]}class $t extends i{constructor(t){super(),c(this,t,mt,dt,u,{filters:0})}}function pt(t,e,n){const r=t.slice();return r[5]=e[n].key,r[6]=e[n].value,r}function ft(t){let e,n,r,a,s,l,o,i=t[5]+"",c=t[6]+"";return{c(){e=d("tr"),n=d("th"),r=O(i),a=D(),s=d("td"),l=O(c),o=D(),m(n,"class","svelte-1lrmq06")},m(t,i){$(t,e,i),P(e,n),P(n,r),P(e,a),P(e,s),P(s,l),P(e,o)},p(t,e){2&e&&i!==(i=t[5]+"")&&A(r,i),2&e&&c!==(c=t[6]+"")&&A(l,c)},d(t){t&&f(e)}}}function gt(t){let e,n,r,a,s,l,o,i=t[1],c=[];for(let u=0;u<i.length;u+=1)c[u]=ft(pt(t,i,u));return{c(){e=d("h2"),e.textContent="Rounds",n=D(),r=d("div"),a=d("div"),s=d("canvas"),l=D(),o=d("table");for(let t=0;t<c.length;t+=1)c[t].c();m(a,"class","chart svelte-1lrmq06"),m(o,"class","svelte-1lrmq06"),m(r,"class","rounds svelte-1lrmq06")},m(i,u){$(i,e,u),$(i,n,u),$(i,r,u),P(r,a),P(a,s),t[4](s),P(r,l),P(r,o);for(let t=0;t<c.length;t+=1)c[t].m(o,null)},p(t,[e]){if(2&e){let n;for(i=t[1],n=0;n<i.length;n+=1){const r=pt(t,i,n);c[n]?c[n].p(r,e):(c[n]=ft(r),c[n].c(),c[n].m(o,null))}for(;n<c.length;n+=1)c[n].d(1);c.length=i.length}},i:p,o:p,d(a){a&&f(e),a&&f(n),a&&f(r),t[4](null),I(c,a)}}}function vt(t,e,n){let r,a,s,{roundTotals:l}=e;return M((()=>{n(3,s=new R(a,{type:"pie",options:{backgroundColor:["rgba(75, 192, 120, 0.2)","rgba(213, 194, 43, 0.2)","rgba(255, 99, 132, 0.2)"],borderColor:["rgb(75, 192, 120)","rgb(213, 194, 43)","rgb(255, 99, 132)"],borderWidth:2},data:{labels:["Innocent (death)","Innocent (timelimit)","Traitors (death)"],datasets:[{data:[]}]}}))})),t.$$set=t=>{"roundTotals"in t&&n(2,l=t.roundTotals)},t.$$.update=()=>{var e,a,o,i,c,u,d;4&t.$$.dirty&&n(1,r=[{key:"Rounds played",value:l.rounds},{key:"Average round length",value:(d=l.playtime/l.rounds,String(Math.floor(d/60)).padStart(2,"0")+":"+String(Math.floor(d%60)).padStart(2,"0"))},{key:"Innocent Wins",value:(Object.values(l.wins.innocent||{none:0}).reduce(((t,e)=>t+e))/l.rounds*100).toFixed()+"%"},{key:"Traitor Wins",value:(Object.values(l.wins.traitor||{none:0}).reduce(((t,e)=>t+e))/l.rounds*100).toFixed()+"%"}]),12&t.$$.dirty&&s&&(n(3,s.data.datasets[0].data=[(null==(a=null==(e=l.wins)?void 0:e.innocent)?void 0:a.death)||0,(null==(i=null==(o=l.wins)?void 0:o.innocent)?void 0:i.timelimit)||0,(null==(u=null==(c=l.wins)?void 0:c.traitor)?void 0:u.death)||0],s),s.update())},[a,r,l,s,function(t){j[t?"unshift":"push"]((()=>{a=t,n(0,a)}))}]}class yt extends i{constructor(t){super(),c(this,t,vt,gt,u,{roundTotals:2})}}function bt(t){let e,n,r,a,s,l,o,i,c,u,g,v;return{c(){e=d("h2"),e.textContent="Items",n=D(),r=d("label"),r.textContent="Select role",a=D(),s=d("select"),l=d("option"),l.textContent="Traitor",o=d("option"),o.textContent="Detective",i=D(),c=d("div"),u=d("canvas"),m(r,"for","item-role"),l.__value="traitor",l.value=l.__value,o.__value="detective",o.value=o.__value,m(s,"id","item-select-role"),void 0===t[0]&&k((()=>t[4].call(s))),m(c,"class","chart")},m(d,m){$(d,e,m),$(d,n,m),$(d,r,m),$(d,a,m),$(d,s,m),P(s,l),P(s,o),E(s,t[0]),$(d,i,m),$(d,c,m),P(c,u),t[5](u),g||(v=N(s,"change",t[4]),g=!0)},p(t,[e]){1&e&&E(s,t[0])},i:p,o:p,d(l){l&&f(e),l&&f(n),l&&f(r),l&&f(a),l&&f(s),l&&f(i),l&&f(c),t[5](null),g=!1,v()}}}function ht(t,e,n){let r,a,s,{items:l}=e;return M((()=>{n(3,a=new R(r,{type:"bar",options:{indexAxis:"y",backgroundColor:["rgba(255, 99, 132, 0.2)","rgba(255, 159, 64, 0.2)","rgba(255, 205, 86, 0.2)","rgba(75, 192, 192, 0.2)","rgba(54, 162, 235, 0.2)","rgba(153, 102, 255, 0.2)","rgba(171, 172, 173, 0.2)"],borderColor:["rgb(255, 99, 132)","rgb(255, 159, 64)","rgb(255, 205, 86)","rgb(75, 192, 192)","rgb(54, 162, 235)","rgb(153, 102, 255)","rgb(171, 172, 173)"],borderWidth:1.5},data:{datasets:[{data:[],label:"times bought",parsing:{yAxisKey:"name",xAxisKey:"count"}}]}}))})),t.$$set=t=>{"items"in t&&n(2,l=t.items)},t.$$.update=()=>{13&t.$$.dirty&&a&&s&&(n(3,a.data.labels=[],a),n(3,a.data.datasets[0].data=l[s],a),a.update())},[s,r,l,a,function(){s=G(this),n(0,s)},function(t){j[t?"unshift":"push"]((()=>{r=t,n(1,r)}))}]}class xt extends i{constructor(t){super(),c(this,t,ht,bt,u,{items:2})}}function wt(t){let e,n,r,a;return e=new yt({props:{roundTotals:t[1]}}),r=new xt({props:{items:t[0]}}),{c(){v(e.$$.fragment),n=D(),v(r.$$.fragment)},m(t,s){y(e,t,s),$(t,n,s),y(r,t,s),a=!0},p(t,[n]){const a={};2&n&&(a.roundTotals=t[1]),e.$set(a);const s={};1&n&&(s.items=t[0]),r.$set(s)},i(t){a||(b(e.$$.fragment,t),b(r.$$.fragment,t),a=!0)},o(t){h(e.$$.fragment,t),h(r.$$.fragment,t),a=!1},d(t){x(e,t),t&&f(n),x(r,t)}}}function Tt(t,e,n){let r,a,{rounds:s}=e;return t.$$set=t=>{"rounds"in t&&n(2,s=t.rounds)},t.$$.update=()=>{var e;4&t.$$.dirty&&n(1,r=s&&Z(s)),4&t.$$.dirty&&n(0,a=s&&(e="role",function(t){var e;const n=new Map;for(const r of t)n.set(r.name,{count:((null==(e=n.get(r.name))?void 0:e.count)||0)+1,role:r.role});return[...n].map((([t,e])=>o({name:t},e))).sort(((t,e)=>e.count-t.count))}(s.flatMap((({items:t})=>t))).reduce(((t,n)=>{const r=n[e];return t[r]=(t[r]||[]).concat(n),t}),{})))},[a,r,s]}class qt extends i{constructor(t){super(),c(this,t,Tt,wt,u,{rounds:2})}}function Ct(t){let e;return{c(){e=d("h2"),e.textContent="Coming soon..."},m(t,n){$(t,e,n)},p:p,i:p,o:p,d(t){t&&f(e)}}}class Dt extends i{constructor(t){super(),c(this,t,null,Ct,u,{})}}function Pt(t){let e,n;return e=new L({props:{basepath:"/ttt-stats/",$$slots:{default:[At]},$$scope:{ctx:t}}}),{c(){v(e.$$.fragment)},m(t,r){y(e,t,r),n=!0},p(t,n){const r={};37&n&&(r.$$scope={dirty:n,ctx:t}),e.$set(r)},i(t){n||(b(e.$$.fragment,t),n=!0)},o(t){h(e.$$.fragment,t),n=!1},d(t){x(e,t)}}}function Ot(t){let e,n;return e=new et({}),{c(){v(e.$$.fragment)},m(t,r){y(e,t,r),n=!0},p:p,i(t){n||(b(e.$$.fragment,t),n=!0)},o(t){h(e.$$.fragment,t),n=!1},d(t){x(e,t)}}}function _t(t){let e,n,r,a;return e=new z({props:{path:"/",$$slots:{default:[Nt]},$$scope:{ctx:t}}}),r=new z({props:{path:"/players",$$slots:{default:[St]},$$scope:{ctx:t}}}),{c(){v(e.$$.fragment),n=D(),v(r.$$.fragment)},m(t,s){y(e,t,s),$(t,n,s),y(r,t,s),a=!0},p(t,n){const a={};36&n&&(a.$$scope={dirty:n,ctx:t}),e.$set(a);const s={};32&n&&(s.$$scope={dirty:n,ctx:t}),r.$set(s)},i(t){a||(b(e.$$.fragment,t),b(r.$$.fragment,t),a=!0)},o(t){h(e.$$.fragment,t),h(r.$$.fragment,t),a=!1},d(t){x(e,t),t&&f(n),x(r,t)}}}function Nt(t){let e,n;return e=new qt({props:{rounds:t[2]}}),{c(){v(e.$$.fragment)},m(t,r){y(e,t,r),n=!0},p(t,n){const r={};4&n&&(r.rounds=t[2]),e.$set(r)},i(t){n||(b(e.$$.fragment,t),n=!0)},o(t){h(e.$$.fragment,t),n=!1},d(t){x(e,t)}}}function St(t){let e,n;return e=new Dt({}),{c(){v(e.$$.fragment)},m(t,r){y(e,t,r),n=!0},i(t){n||(b(e.$$.fragment,t),n=!0)},o(t){h(e.$$.fragment,t),n=!1},d(t){x(e,t)}}}function At(t){let e,n,r,a,s,l,o,i,c;function u(e){t[4](e)}let p={};void 0!==t[0]&&(p.filters=t[0]),a=new $t({props:p}),j.push((()=>W(a,"filters",u)));let g=t[2]&&_t(t);return i=new ut({}),{c(){e=d("main"),n=d("h1"),n.textContent="Trouble in Terrorist Town â€” Statistics",r=D(),v(a.$$.fragment),l=D(),g&&g.c(),o=D(),v(i.$$.fragment),m(n,"class","svelte-12mrmby"),m(e,"class","svelte-12mrmby")},m(t,s){$(t,e,s),P(e,n),P(e,r),y(a,e,null),P(e,l),g&&g.m(e,null),$(t,o,s),y(i,t,s),c=!0},p(t,n){const r={};!s&&1&n&&(s=!0,r.filters=t[0],J((()=>s=!1))),a.$set(r),t[2]?g?(g.p(t,n),4&n&&b(g,1)):(g=_t(t),g.c(),b(g,1),g.m(e,null)):g&&(F(),h(g,1,1,(()=>{g=null})),B())},i(t){c||(b(a.$$.fragment,t),b(g),b(i.$$.fragment,t),c=!0)},o(t){h(a.$$.fragment,t),h(g),h(i.$$.fragment,t),c=!1},d(t){t&&f(e),x(a),g&&g.d(),t&&f(o),x(i,t)}}}function It(t){let e,n,r,a;const s=[Ot,Pt],l=[];function o(t,e){return t[1]?0:1}return e=o(t),n=l[e]=s[e](t),{c(){n.c(),r=U()},m(t,n){l[e].m(t,n),$(t,r,n),a=!0},p(t,[a]){let i=e;e=o(t),e===i?l[e].p(t,a):(F(),h(l[i],1,1,(()=>{l[i]=null})),B(),n=l[e],n?n.p(t,a):(n=l[e]=s[e](t),n.c()),b(n,1),n.m(r.parentNode,r))},i(t){a||(b(n),a=!0)},o(t){h(n),a=!1},d(t){l[e].d(t),t&&f(r)}}}function Mt(t,e,n){let r,a,s,l=!0;return(async()=>{n(3,a=await Y()),n(1,l=!1)})(),t.$$.update=()=>{9&t.$$.dirty&&n(2,r=a&&s&&function(t,{minPlayers:e,maxPlayers:n,minDate:r,maxDate:a}){return t.filter((({playerCounts:t,date:s})=>("number"!=typeof e||t.total>=e)&&("number"!=typeof n||t.total<=n)&&(isNaN(r)||s>=r)&&(isNaN(a)||s<=a)))}(a.rounds,s))},[s,l,r,a,function(t){s=t,n(0,s)}]}new class extends i{constructor(t){super(),c(this,t,Mt,It,u,{})}}({target:document.getElementById("app")});
